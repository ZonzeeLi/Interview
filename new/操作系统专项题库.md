# 操作系统专项题库

## 存储结构

### 为什么计算机要给储存结构分级？

操作系统的存储结构有，CPU 寄存器、CPU L1、L2、L3 级缓存、内存、硬盘，访问的速度由快到慢。之所以要分级，有以下原因：

- 考虑到成本问题，由于速度越快的存储结构需要的硬件材料成本越贵，所以分级可以权衡考虑。
- 使用阶段，CPU 正在执行的工作所需的上下文存储在 CPU 寄存器中，会更快访问，L1 中存储一些指令集和数据，L3 是多核 CPU 共享的空间，内存是暂时存放 CPU 需要的一些数据，可能会用到，而磁盘是永久存放数据的，大部分不会及时用到。所以没必要都放在一个地方。

### CPU cache L1 L2 L3 读取数据的时间量级差距有多大？

L1、L2、L3 的访问速度由快到慢，L1、L2、L3 的时间都是在 ns 量级左右，彼此之间应该是几个时钟周期和几十个时钟周期的差距。

### CPU 缓存对程序性能的影响都体现在哪些方面？

- 缓存大小：如果缓存大，存储的数据和指令更多，会提高性能。
- 缓存命中率：如果命中率高，会提高性能，反之命中率低会频繁的从内存中读取。
- 预读：CPU Cache Line 会将数据预读出来，比如可能是用的是0-4k的数据，但是其后面的数据大概率被访问，CPU Cache Line 会预读出来0-16k的数据。

### 如何写 CPU 缓存友好的程序？

- 提高数据的缓存命中率：比如如下代码，

```
for i := 0;i < n;i ++ {
	for j := 0;j < m;j ++ {
			a[i][j] = ....
	}
}
```

```
for i := 0;i < n;i ++ {
	for j := 0;j < m;j ++ {
			a[j][i] = ....
	}
}
```

第一段代码的命中率就高于第二个，因为二维数组在内存中存放是连续的形式， CPU 读取数据是也是按照顺序读取的，并且会预读，如果是`a[j][i]`，下一个数据是`a[j+1][i]`，在数据量很大时可能不会命中到。

- 提高指令的命中率：CPU 会通过分支预测将指令提前缓存，最常见的是 if else 指令，如果某个条件出现的频率高，CPU 会将其分支下的指令先缓存，可以利用这一点提高命中率。
- 避免多核 CPU 的频繁切换：程序可能在 CPU 之间来回切换执行，这时候可以让一个 CPU 绑定一个程序执行，避免切换影响性能问题。

## 内核态

### 为什么要区分内核态和用户态？内核态和用户态区别？

为什么要区分：

- 内核有很高的权限，为了避免用户直接操作内核，发生不可避免的错误；
- 内核态的代码和指令的迭代速度不如用户态这么自由，用户可以根据自己的需求发起内核调用，避免互相牵制；

区别：

- 用户态的资源和操作受到限制，内核态可以访问所有的资源和执行操作，级别更高。

### 什么时候会由用户态陷入内核态？

- 当发生系统调用的时候；
- 用户态触发中断；
- 用户态执行其他需要内核权限的操作。

### 系统调用的过程？



## 进程&线程

### 进程和线程有什么区别？

### 为什么创建进程比创建线程慢？

### 为什么进程的切换比线程开销大？

### 协程和线程有什么区别？

### 进程间有哪些通信方式？哪一种效率最高？

### 线程间同步方式有哪一些？

### 并行和并发的区别

## 锁

### 自旋锁和互斥锁有什么区别？什么时候用自旋锁？什么时候用互斥锁？

### 悲观锁和乐观锁有什么区别？

### 乐观锁怎么实现？

### 操作系统死锁怎么产生的？

### 如何避免出现死锁，怎么排查？

## 内存管理

### 为什么操作系统会有虚拟内存？

### 数组的物理空间连续吗？

### 进程的虚拟内存的布局是怎么样的？

### 堆区和栈区的区别

### 在栈上的数据操作比堆上快很多的原因？

### fork 的写时复制是如何实现的？

## Linux 命令

### Linux 怎么查看 CPU 利用率？

### Linux top 命令展示了哪些信息？

### Linux 下如何查看端口被哪个进程占用？

### Linux 系统 CPU 100% 怎么排查？

### 查找一个字符串是否在文件中

