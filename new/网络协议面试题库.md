# 网络协议面试题库

## 场景

### 介绍一下 OSI 七层协议，各层协议都有哪些？

按照顺序依次是，应用层、表示层、会话层、传输层、网络层、数据链路层、物理层

应用层的协议有 HTTP、HTTPS，传输层有 TCP、UDP，网络层有 IP、ICMP。

### IP 协议和 TCP 协议属于哪一层？

IP 是网络层，TCP 是传输层。

### 输入网址后，期间发生了什么？

1. 输入网址后，会对 URL 进行解析，得到要发往的 Web 服务器、文件路径、请求参数、协议等内容。
2. 然后通过域名解析 DNS，得到要访问服务器的 IP 地址。先查看本地系统缓存的 host 文件中是否有记录，没有就会去域名服务器获取 IP 地址。
3. 接着由于需要 TCP 建立三次握手连接，所以要生成 TCP 的报文信息，填入源端口和目的端口，在建立连接之后，就可以通过 TCP 传入数据，如果长度超过了 MSS，会进行分片。
4. 接着到网络层，会填入源 IP 地址和目的 IP 地址，以及协议号等 IP 报文信息，封装成网络包发送。
5. 然后到数据链路层，会填入源 MAC 地址和目标 MAC 地址，如果有缓存保存了目标 MAC 地址，则直接使用，如果不知道目标 MAC 地址，会通过地址解析协议 ARP，以广播的形式，获取路由的 MAC 地址。
6. 接着会通过网卡将数据包转换成电信号发送出去。
7. 通过交换机到达路由器，然后路由器会通过路由表转发到目的服务器，然后获取响应后返回。

### DNS 是如何解析的？

以`www.server.com`为例，DNS 会先查询本地域名服务器缓存的 host 文件中是否有目标的 IP 地址，如果没有的话，会请求根域名服务器`.`，根域名服务器会返回顶级域名服务器`.com`，然后请求顶级域名服务器`.com`，顶级域名服务器会返回权威 DNS 服务器的地址，然后权威域名服务器会返回`www.server.com`的 IP 地址。

### 输入域名如何知道端口的？

服务端 http 的默认端口是 80，https 的默认端口是 443，如果服务端自己写了服务 bind 端口则使用具体的的端口。

### 如果浏览器没有显示页面有哪些原因？

首先确定下是不是客户端的网络问题，排查下是不是断网、没有网卡等问题，其次检查下是否填写正确访问到了正确的服务端地址，然后可以在命令行尝试`ping`一下服务端，确定可以建立正常的连接，如果连接出现问题则可以抓包分析究竟是哪一包出现了问题，然后可以通过返回的 http 状态码进行分析，比如 404 not found，可能是服务端下线或者访问地址输入错误，如果是 500 ，可能是服务端繁忙、崩溃等问题。最后看是否是前端渲染的代码出现 bug 问题。

### 客户端 TCP 连接一个不存在的 IP 地址的服务端会发生什么？

由于目标地址不存在，网络包在路由之间跳转，超过生命周期或者跳转次数之后，这个包就会丢弃，路由会通过 ICMP 返回一个不可达序号报文。

### 客户端 TCP 连接一个 IP 地址存在但是端口不存在报文会发生什么？

由于 IP 地址存在，网络包可以到达，但是端口不存在，说明没有 listen()，这时候会回复一个 RST 断开连接报文。

### 客户端 UDP 发送一个 IP 地址存在但是端口不存在报文会发生什么？

服务端会通过 ICMP 返回一个端口不存在序号报文。

### 四层和七层负载均衡的区别

四层负载均衡主要是在传输层中实现，不关心报文中的内容，通过目的地址和端口，再选择一个内部服务器，会对目标地址进行修改。而七层负载均衡是在应用层实现，会解析报文，针对报文中的内容，比如 URL 或者 Cookie 中的信息做出负载均衡。

## HTTP 

### HTTP 报文格式？怎么分割的？

HTTP 的报文分成请求报文和响应报文两种：

请求报文包含请求行、请求头、请求体，其中请求行是请求的 method（GET、POST等），以及请求的 HTTP 版本和路径，请求头中是一些属性值和 tag 标签，比如 Content-Lenth、Connection 等字段的属性值，请求体是具体的请求 body 数据。

响应报文包含响应状态、响应头、响应体，其中响应状态是响应的 HTTP 版本和状态码信息，响应头中也是一些 Content-Lenth、Connection 等字段的属性值和 tag 标签，响应体是返回的具体 body 数据。

分割是通过换行符来进行分割的，如果数据中包含换行符要进行转义。

### HTTP 有什么方法

常用的是 GET 获取资源、POST 带着请求数据访问服务端、DELETE 删除资源、PUT 带着更新数据访问服务端。

### 分析一下哪些 HTTP 方法是安全或者幂等的？

以 GET、POST、DELETE、PUT 为例，只有 GET 是幂等的，因为获取资源，并不会提交更新的操作，多次操作的结果都是一样的，而另外三种方法会对资源进行修改，不是幂等的。

### GET 和 POST 请求的区别？追问：GET 请求一定是安全且幂等的吗？

GET 是请求从服务端获取资源，POST 是带着请求数据去更改服务端的资源，但这不一定说 GET 请求就一定是幂等的，具体要看服务端的 handler 实现逻辑，服务端可以将 GET 方法做成和 POST 一样可以修改资源的逻辑。

### HTTP 有什么状态码？

HTTP 的状态码有五大类，分别是 1、2、3、4、5 开头：

- 1xx 开头的状态码，表示处理的中间状态，后续还有操作；
- 2xx 开头的状态码，表示请求成功，比如 200 就是常见的 请求成功，204 表示成功但是没有响应数据，206 表示成功但是响应并不是完整的资源，只是分块的一部分；
- 3xx 开头的状态码，表示服务端重定向，比如 301 是永久重定向，服务端的资源已经更换地址，302 是临时重定向，服务端的资源需要临时访问一个其他地址获取，304 是服务端的资源未修改，可以使用客户端本身的缓存资源来使用；
- 4xx 开头的状态码，表示的错误状态码，服务端处理错误，比如 404 就是 not found，表示服务端下线或者访问的地址不存在，400 表示的是请求的报文格式或内容有错，403 表示的是禁止客户端访问，一般像鉴权失败的时候返回；
- 5xx 开头的状态码，表示的是服务端出错了，具体的错误由状态码决定，比如 500 表示的是服务器繁忙，一般是服务端处理不过来、崩溃、自定义错误信息返回，501 表示的是服务端暂不支持此功能，502 表示的是 bad gateway，